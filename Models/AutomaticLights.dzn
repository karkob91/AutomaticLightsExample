interface ILightShifter {
    in void Toogle();

    behavior {
        on Toogle: {}
    }

}

interface IHighBeamsRelay {
    in void TurnOn();
    in void TurnOff();
    

    behavior {
        bool isTurnedOn = false;

        [isTurnedOn] {
            
            on TurnOff: {
                isTurnedOn = false;
            }
        }
        [!isTurnedOn] {
            on TurnOn: {
                isTurnedOn = true;
            }
            
        }
    }

}

interface ILightSensor {
    out void LowLight();
    out void HighLight();
    enum State {Low, High};

    behavior {
        State state = State.High;
        [state.High] {
            on inevitable: {
                state = State.Low;
                LowLight;
            }
        }
        [state.Low] {
            on inevitable: {
                state = State.High;
                HighLight;
            }
        }
    }
}

interface IFrontCamera {
    out void CarDetected();
    out void CarPassed();
    enum State {Detected, NotDetected};

    behavior {
        State state = State.NotDetected;

        [state.NotDetected] {
            on inevitable: {
                state = State.Detected;
                CarDetected;
            }
        }
        [state.Detected] {
            on inevitable: {
                state = State.NotDetected;
                CarPassed;
            }
        }
    }
}




component ModeSelector {
    provides ILightShifter lightShifter;
    requires IHighBeamsRelay beamsRelay;
    requires ILightSensor lightSensor;
    // requires IFrontCamera frontCamera;

    behavior {

        enum ControlMode {Automatic, Manual};
        ControlMode mode = ControlMode.Manual;

        void ToggleLights() {
            if(beamsRelay.isTurnedOn)
                beamsRelay.TurnOff();
            else {
                beamsRelay.TurnOn();
            }
        }

        // [beamsRelay.isTurnedOn] {
        [mode.Manual] {
            on lightShifter.Toogle(): {
                ToggleLights();
            }
            on lightSensor.HighLight(): {}
            on lightSensor.LowLight(): {
                if(!beamsRelay.isTurnedOn) {
                    beamsRelay.TurnOn();
                    mode = ControlMode.Automatic;
                }
            }
        }
        [mode.Automatic] {
            on lightShifter.Toogle(): {
                ToggleLights();
                mode = ControlMode.Manual;
            }
            on lightSensor.LowLight(): {
                if(!beamsRelay.isTurnedOn) 
                    beamsRelay.TurnOn();
            }
            on lightSensor.HighLight(): {
                if(beamsRelay.isTurnedOn) 
                    beamsRelay.TurnOff();
            }
            

        }

        
    }

}